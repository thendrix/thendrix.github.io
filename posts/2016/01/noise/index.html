<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="Terry Hendrix">
<meta name="description" content="Update: Screenshots with realistic sized trees on same terrain, and fixed some links. :3
 Tree scale now in 10-20m range
 Tree scale now in 10-20m range
I noticed r/proceduralgeneration has a lot activity lately, so I thought I would do quick post on how I&amp;rsquo;m generating my current test islands with only 4 functions. This is what they typically look like:
 Terrain generated by simple density function" />
<meta name="keywords" content=", terrain" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="/posts/2016/01/noise/" />


    <title>
        
            Noise! :: Thoughts on GameDev 
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/main.min.7bfbbe12786fa0ded4b4c0d792cbb36a5bd0bdb0b856dde57aa7b1f6fe0f2b87.css">




<meta itemprop="name" content="Noise!">
<meta itemprop="description" content="Update: Screenshots with realistic sized trees on same terrain, and fixed some links. :3
 Tree scale now in 10-20m range
 Tree scale now in 10-20m range
I noticed r/proceduralgeneration has a lot activity lately, so I thought I would do quick post on how I&rsquo;m generating my current test islands with only 4 functions. This is what they typically look like:
 Terrain generated by simple density function">
<meta itemprop="datePublished" content="2016-01-30T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2016-01-30T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="817">
<meta itemprop="image" content="/"/>



<meta itemprop="keywords" content="terrain," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/"/>

<meta name="twitter:title" content="Noise!"/>
<meta name="twitter:description" content="Update: Screenshots with realistic sized trees on same terrain, and fixed some links. :3
 Tree scale now in 10-20m range
 Tree scale now in 10-20m range
I noticed r/proceduralgeneration has a lot activity lately, so I thought I would do quick post on how I&rsquo;m generating my current test islands with only 4 functions. This is what they typically look like:
 Terrain generated by simple density function"/>





    <meta property="article:published_time" content="2016-01-30 00:00:00 &#43;0000 UTC" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /Thoughts/On/GameDev</span>
            <span class="logo__cursor" style=
                  "
                   background-color:#aaa;
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/posts/">Posts</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>4 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="/posts/2016/01/noise/">Noise!</a>
            </h1>

            

            <div class="post-content">
                <p><strong>Update</strong>: Screenshots with realistic sized trees on same terrain, and fixed some links.  :3</p>
<p><a href="/images/20160130/kagura-0.15.0-20160204-175819-0000.png"><img src="/images/20160130/kagura-0.15.0-20160204-175819-0000.png" alt="gallery" title="Tree scale now in 10-20m range"></a>
<em>Tree scale now in 10-20m range</em></p>
<p><a href="/images/20160130/kagura-0.15.0-20160204-182246-0000.png"><img src="/images/20160130/kagura-0.15.0-20160204-182246-0000.png" alt="gallery" title="Tree scale now in 10-20m range"></a>
<em>Tree scale now in 10-20m range</em></p>
<p>I noticed <a href="https://www.reddit.com/r/proceduralgeneration">r/proceduralgeneration</a> has a lot activity lately, so I thought I would do quick post on how I&rsquo;m generating my current test islands with only 4 functions.  This is what they typically look like:</p>
<p><a href="/images/20160130/kagura-0.15.0-20160130-002137-0000.png"><img src="/images/20160130/kagura-0.15.0-20160130-002137-0000.png" alt="gallery" title="Terrain generated by simple density function"></a>
<em>Terrain generated by simple density function</em></p>
<h2 id="terrian-geometry">Terrian Geometry</h2>
<p>I basically use both 2d and 3d simplex noise to add and subtract a global density function, which is described per terrain cube.  You can stack cubes like octrees, or more typically just a simple XZ grid.  This density function is used to produce voxels, which are then in turn converted to meshes for physics and rendering.  I don&rsquo;t use GPU rendering of the voxels as I need that GPU time for VR.  :3</p>
<p>All of this is done in realtime via the clever use of worker threads with the option to serialize them out as models.  Each cube is typically 256 meters.  Yes, this means if you want really tall mountains you need to stack another layer of cubes on top of your XZ grid.</p>
<p>This listing shows how I build the density function to pass into a now obsolete KaMeshComponent, which will then in turn start deferred creation of the meshes for physics and rendering.  The above island is solely defined as as the global density function:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua"><span style="color:#66d9ef">local</span> density <span style="color:#f92672">=</span> KaDensity.Create()
KaDensity.Seed( density, <span style="color:#ae81ff">2312.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">561.972</span> )
KaDensity.AddFractalNoise2d( density, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">32.0</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">32.0</span> )
KaDensity.AddFractalNoise2d( density, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">8.0</span> )
KaDensity.SubFractalNoise2d( density, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">64.0</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">6.0</span> )
KaDensity.AddFractalNoise3d( density, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">32.0</span>, <span style="color:#ae81ff">4.5</span> )
</code></pre></div><p><em>listing 1</em></p>
<p>Notice there is little use of 3d, as that is more for making hills, caves, rivers, and arches.  Also you could introduce local density for features, but I don&rsquo;t typically do any manual level editing at this point in project.  This is one of my small islands used for testing materials.</p>
<h2 id="terrian-material">Terrian Material</h2>
<p>The terrain is composed from a simple triplanar shader.  World height, world slope, and a per pixel Fractal Brownian Motion ( FBM ) to break up the monotony of ground foliage.  There are typically beach sand, dirt, grass ( eg green to brown / height ), and stone generated from this step.  Since you can modify shaders at runtime in kagura this can be fun to improve when you have a few extra minutes in the day.</p>
<h2 id="terrian-foliage">Terrian Foliage</h2>
<p>Once terrain geometry is instanced it will be filled with large vegetation and deco such as bushes and trees to rocks and statues.  For every XY terrain sector I generate a SpawnTracer.  The spawner will &lsquo;ping&rsquo; for the worker threads to be done by ray casting for terrain to appear in its given sector.  Once this is done it issues the given spawn callback.  In this case the callback is a per sector foliage trace driven again by a grid pattern filtered by a tillable FBM ( see <a href="/posts/2015/12/screenshot-weekend/">old blog post</a> ), slope, height, max per tile count of an object type, and a few other attributes.  This pass handles the case where a house is placed on terrain for example, so it would not put trees and grass on top of it.  It is important to note these happen out of order, and the tiling pattern provided by the FBM is the trick making smooth transitions between tiles possible.</p>
<p><a href="/images/20160130/kagura-0.15.0-20160130-123928-0000.png"><img src="/images/20160130/kagura-0.15.0-20160130-123928-0000.png" alt="gallery" title="Closer look at the same scene"></a>
<em>Closer look at the same scene</em></p>
<p>That&rsquo;s basically how the system works, and it&rsquo;s a little more complex than that but not much.  I&rsquo;d be happy to answer any questions or take comments.  Here&rsquo;s a script function that creates the entire island above:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lua" data-lang="lua"><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">VoxelTerrainComponent</span>.<span style="color:#a6e22e">OnCreate</span>( self )
	<span style="color:#66d9ef">local</span> sz <span style="color:#f92672">=</span> self.width
	<span style="color:#66d9ef">local</span> hsz <span style="color:#f92672">=</span> self.height
	<span style="color:#66d9ef">local</span> scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">256.0</span>

	<span style="color:#66d9ef">local</span> density <span style="color:#f92672">=</span> KaDensity.Create()
	KaDensity.Seed( density, <span style="color:#ae81ff">2312.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">561.972</span> )
	KaDensity.AddFractalNoise2d( density, <span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">32.0</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">32.0</span> )
	KaDensity.AddFractalNoise2d( density, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">8.0</span> )
	KaDensity.SubFractalNoise2d( density, <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">64.0</span>, <span style="color:#ae81ff">8.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">6.0</span> )
	KaDensity.AddFractalNoise3d( density, <span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">32.0</span>, <span style="color:#ae81ff">4.5</span> )

	<span style="color:#66d9ef">for</span> x <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>sz, sz <span style="color:#66d9ef">do</span>
	<span style="color:#66d9ef">for</span> y <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, hsz <span style="color:#66d9ef">do</span>
	<span style="color:#66d9ef">for</span> z <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>sz, sz <span style="color:#66d9ef">do</span>
		<span style="color:#66d9ef">local</span> name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;VoxelMesh_&#34;</span> <span style="color:#f92672">..</span> x <span style="color:#f92672">..</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">..</span> y <span style="color:#f92672">..</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">..</span> z
		<span style="color:#66d9ef">local</span> dump <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Cache/&#39;</span> <span style="color:#f92672">..</span> name <span style="color:#f92672">..</span> <span style="color:#e6db74">&#39;.asset&#39;</span>
		<span style="color:#66d9ef">local</span> sector <span style="color:#f92672">=</span> KaGameObject.New( x <span style="color:#f92672">*</span> scale, y <span style="color:#f92672">*</span> scale, z <span style="color:#f92672">*</span> scale )
		KaGameObject.SetName( sector, name )
		KaMeshComponent.CreateFromVoxels(sector, density, dump, self.material, x,y,z)
		KaGameObject.Finalize( sector )
		KaGameObject.Hide( sector )
		KaGameObject.AddChild( self._GameObject, sector )

		<span style="color:#66d9ef">if</span> self.foliage <span style="color:#f92672">and</span> y <span style="color:#f92672">==</span> <span style="color:#ae81ff">0.0</span> <span style="color:#66d9ef">then</span>
			<span style="color:#75715e">-- Place spawners and mappers in the middle of the voxel sector.</span>
			<span style="color:#66d9ef">local</span> offset <span style="color:#f92672">=</span> scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span>
			SpawnByTracePrefabChild( <span style="color:#e6db74">&#34;FoliageSpawner&#34;</span>, self._GameObject,
					x <span style="color:#f92672">*</span> scale <span style="color:#f92672">+</span> offset,
					y <span style="color:#f92672">*</span> scale <span style="color:#f92672">+</span> scale <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.75</span>,
					z <span style="color:#f92672">*</span> scale <span style="color:#f92672">+</span> offset,
					<span style="color:#75715e">-- VoxelSectorFoliageCb )</span>
					VoxelSectorFoliageFbmCb )
		<span style="color:#66d9ef">end</span>
	<span style="color:#66d9ef">end</span>
	<span style="color:#66d9ef">end</span>
	<span style="color:#66d9ef">end</span>
<span style="color:#66d9ef">end</span>
</code></pre></div><p><em>listing 2</em></p>
<p>And here&rsquo;s what you can do with unfiltered 3d noise:</p>
<p><a href="/images/20160130/kagura-0.15.0-20160128-170004-0000.png"><img src="/images/20160130/kagura-0.15.0-20160128-170004-0000.png" alt="gallery" title="Terrain Generated from Unfiltered 3d Noise"></a>
<em>Terrain Generated from Unfiltered 3d Noise</em></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
                <p>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="/tags/terrain">terrain</a></span>
                </p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>817 Words</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2016-01-29 16:00 -0800</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="/posts/2019/05/terrain-and-breadknives/">
                                <span class="button__icon">←</span>
                                <span class="button__text">Terrain and Breadknives</span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="/posts/2015/12/screenshot-weekend/">
                                <span class="button__text">Screenshot Weekend</span>
                                <span class="button__icon">→</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
                <span><a href="/">Terry Hendrix II</a></span>
            
            <span></span>
            <span> <a href="/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>



    </body>
</html>
